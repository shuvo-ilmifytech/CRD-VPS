name: Windows CRD Setup (Choco Fix)

on: workflow_dispatch

jobs:
  build:
    name: Start Windows CRD
    runs-on: windows-latest
    timeout-minutes: 360

    steps:
    - name: Checkout Code
      uses: actions/checkout@v4

    - name: Install Chrome Remote Desktop (via Chocolatey)
      run: |
        Write-Host "Installing Chrome Remote Desktop using Choco..."
        choco install chrome-remote-desktop -y --no-progress
        Write-Host "Installation Complete."

    - name: Setup CRD Authorization
      shell: powershell
      run: |
        # আপনার Secret কোডটি রান করা হচ্ছে
        # নোট: যদি Google এর দেওয়া কোডে পাথ বা লোকেশন নিয়ে সমস্যা থাকে,
        # তবে এই কমান্ডটি অটোমেটিক সঠিক পাথ খুঁজে রান করার চেষ্টা করবে।
        
        $cmd = "${{ secrets.CRD_CODE }}"
        
        # যদি ইউজার পুরো কমান্ড কপি করে থাকেন তবে সরাসরি রান করবে
        Invoke-Expression $cmd

    - name: Keep Session Alive
      run: |
        Write-Host "CRD is running successfully. Connect now!"
        while ($true) {
          Start-Sleep -Seconds 60
          Write-Host "Session is active..."
        }
