name: Windows CRD Setup (Final Fix)

on: workflow_dispatch

jobs:
  build:
    name: Start Windows CRD
    runs-on: windows-latest
    timeout-minutes: 360

    steps:
    - name: Checkout Code
      uses: actions/checkout@v4

    - name: Download CRD with User-Agent
      run: |
        Write-Host "Downloading Chrome Remote Desktop..."
        $url = "https://dl.google.com/edgedl/chrome-remote-desktop/chromeremotedesktop.msi"
        $output = "crd.msi"
        # Google কে ফাঁকি দেওয়ার জন্য User-Agent ব্যবহার করা হচ্ছে
        $userAgent = "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"
        Invoke-WebRequest -Uri $url -OutFile $output -UserAgent $userAgent
        
        Write-Host "Download Complete. Installing..."
        Start-Process msiexec.exe -ArgumentList "/i crd.msi /qn" -Wait
        Remove-Item crd.msi

    - name: Setup CRD Authorization
      shell: powershell
      run: |
        # আপনার Secret কোড রান করা হচ্ছে
        $cmd = "${{ secrets.CRD_CODE }}"
        Invoke-Expression $cmd

    - name: Keep Session Alive
      run: |
        Write-Host "CRD is running successfully. Connect now!"
        while ($true) {
          Start-Sleep -Seconds 60
          Write-Host "Session is active..."
        }
