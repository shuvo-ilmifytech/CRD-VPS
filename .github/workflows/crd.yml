name: Windows CRD Setup

on: workflow_dispatch

jobs:
  build:
    name: Start Windows CRD
    runs-on: windows-latest
    timeout-minutes: 360 # সর্বোচ্চ ৬ ঘণ্টা চলবে

    steps:
    - name: Checkout Code
      uses: actions/checkout@v4

    - name: Install Chrome Remote Desktop
      run: |
        Write-Host "Downloading Chrome Remote Desktop..."
        Invoke-WebRequest -Uri "https://dl.google.com/edgedl/chrome-remote-desktop/chromeremotedesktop.msi" -OutFile "crd.msi"
        Write-Host "Installing CRD..."
        Start-Process msiexec.exe -ArgumentList "/i crd.msi /qn" -Wait
        Del crd.msi

    - name: Setup CRD Authorization
      shell: powershell
      run: |
        & ${{ secrets.CRD_CODE }} -pin ${{ secrets.PIN }}

    - name: Keep Session Alive
      run: |
        Write-Host "CRD is running successfully. Connect now!"
        # এই লুপটি সেশনটিকে বন্ধ হওয়া থেকে আটকাবে
        while ($true) {
          Start-Sleep -Seconds 60
          Write-Host "Session is active..."
        }
